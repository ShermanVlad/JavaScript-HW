<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible"
          content="ie=edge">
    <title>User-details</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        body>.userInfoDiv {
            display: flex;
            flex-direction: column;
            /*align-items: center;*/
            padding-left: 30px;
            padding-right: 30px;
            margin: 30px;
            justify-content: space-evenly;
            border: 2px solid red;
            background-color: peachpuff;
        }
    </style>
</head>
<body>
<script>

    // На странице user-details.html:
    // 4 Вивести всю, без виключення, інформацію про об'єкт user на який клікнули
    // 5 Додати кнопку "post of current user", при кліку на яку, з'являються title всіх постів поточного юзера
    // (для получения постов используйте эндпоинт https://jsonplaceholder.typicode.com/users/USER_ID/posts)
    // // 6 Каждому посту додати кнопку/посилання, при кліку на яку відбувається перехід на сторінку post-details.html, котра має детальну інфу про поточний пост.

    // user-details.html - блок з інфою про user зверху сторінки. Кнопка нижчє, на 90% ширини сторінки, по центру.

    const url = new URLSearchParams(location.search)
    const userID = url.get('id')

    fetch(`https://jsonplaceholder.typicode.com/users/${userID}`)
        .then(value => value.json())
        .then(user => {

            let userInfoDiv = document.createElement('div');
            userInfoDiv.classList = 'userInfoDiv';
            document.body.appendChild(userInfoDiv);

            for (const [key, values] of Object.entries(user)) {

                if (typeof values !== 'object') {

                    let text = document.createElement('h4');
                    userInfoDiv.appendChild(text);
                    text.innerText = `${key}: ${values}`;

                } else {

                    let text = document.createElement('h4');
                    userInfoDiv.appendChild(text);
                    text.innerText = `${key}:`;

                    let keyUl = document.createElement('ul');
                    userInfoDiv.appendChild(keyUl);

                    for (const value in values) {
                        if (typeof values[value] !== 'object') {
                            let valueLi = document.createElement('li');
                            keyUl.appendChild(valueLi);
                            valueLi.innerText = `${value}: ${values[value]}`;
                        } else {
                            let valueLi = document.createElement('li');
                            keyUl.appendChild(valueLi);
                            valueLi.innerText = `${value}:`;

                            let geoUl = document.createElement('ul');
                            valueLi.appendChild(geoUl);

                            for (const [valueObjKey,keyObjKey] of Object.entries(values[value])) {
                                let geoLi = document.createElement('li');
                                geoUl.appendChild(geoLi);
                                geoLi.innerText = `${valueObjKey}: ${keyObjKey}`;
                            }
                        }
                    }
                }
            }

            let postsBtn = document.createElement('button');
            document.body.appendChild(postsBtn);
            postsBtn.innerText = `Post of current user`;
            postsBtn.style.width = '90%';

            let postsDiv = document.createElement('div');
            document.body.appendChild(postsDiv);
            postsBtn.onclick=function () {
                postsDiv.style.border = '1px solid green';
                postsDiv.style.margin = '30px';
                postsDiv.style.width = '90%';
                postsDiv.style.display = 'flex';
                postsDiv.style.flexDirection = 'row';
                postsDiv.style.flexWrap = 'wrap';
                postsDiv.innerText = '';


                let postsUl = document.createElement('ul');
                postsDiv.appendChild(postsUl);

                fetch(`https://jsonplaceholder.typicode.com/users/${userID}/posts`)
                    .then(value => value.json())
                    .then(posts => {
                        for (const post of posts) {

                            let postLi = document.createElement('li');
                            postsUl.appendChild(postLi);
                            postLi.innerText = post.title;

                            let postLink = document.createElement('a');
                            postLi.appendChild(postLink);
                            postLink.href = `post-details.html?id=${post.id}`;
                            postLink.innerText = `more...`;
                            postLink.style.marginLeft = '10px';
                            postLink.onclick = function (){
                                location.href = `post-details.html?id=${post.id}`;
                            }
                        }
                    });
            }
        })

</script>
</body>
</html>